<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>言葉 Kotoba — Anime Quotes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Syne:wght@400;500;700;800&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --ink: #0c0c0c;
      --paper: #f5f0e8;
      --accent: #c0392b;
      --accent-dim: rgba(192, 57, 43, 0.12);
      --muted: #6b6560;
      --line: rgba(245, 240, 232, 0.1);
      --surface: #161616;
      --overlay: rgba(12, 12, 12, 0.88);
    }

    [data-theme="light"] {
      --ink: #f5f0e8;
      --paper: #1a1714;
      --muted: #8a8480;
      --line: rgba(26, 23, 20, 0.12);
      --surface: #ede8df;
      --overlay: rgba(245, 240, 232, 0.92);
    }

    html {
      height: 100%;
      overflow: hidden;
    }

    body {
      background-color: var(--ink);
      color: var(--paper);
      font-family: 'Syne', sans-serif;
      height: 100%;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease, color 0.3s ease;
      overflow: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
      opacity: 0.4;
    }

    .loading-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 2px;
      background: var(--accent);
      width: 0%;
      z-index: 200;
      transition: none;
    }

    .loading-bar.running {
      width: 75%;
      transition: width 0.5s ease;
    }

    .loading-bar.done {
      width: 100%;
      transition: width 0.15s ease;
    }

    header {
      padding: 1.5rem 3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--line);
      position: relative;
      z-index: 10;
      gap: 1rem;
      flex-shrink: 0;
    }

    .logo {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .logo-text {
      font-family: 'Playfair Display', serif;
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      color: var(--paper);
      line-height: 1;
    }

    .logo-sub {
      font-size: 0.6rem;
      font-weight: 500;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .icon-btn {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--muted);
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: color 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      font-size: 1rem;
      flex-shrink: 0;
      user-select: none;
    }

    .icon-btn:hover {
      color: var(--paper);
      border-color: rgba(245, 240, 232, 0.3);
    }

    .icon-btn.active {
      color: var(--accent);
      border-color: var(--accent);
      background: var(--accent-dim);
    }

    .fav-count {
      font-size: 0.6rem;
      font-weight: 700;
    }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 3rem;
      position: relative;
      z-index: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    main::-webkit-scrollbar { width: 3px; }
    main::-webkit-scrollbar-track { background: transparent; }
    main::-webkit-scrollbar-thumb { background: var(--line); }

    .quote-stage {
      max-width: 820px;
      width: 100%;
      animation: fadeUp 0.5s ease forwards;
    }

    .quote-eyebrow {
      font-size: 0.62rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      min-height: 1.2rem;
    }

    .quote-eyebrow::after {
      content: '';
      display: block;
      width: 60px;
      height: 1px;
      background: var(--line);
    }

    .qotd-badge {
      background: var(--accent);
      color: #fff;
      font-size: 0.52rem;
      letter-spacing: 0.15em;
      padding: 0.18rem 0.5rem;
      font-weight: 700;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .qotd-badge.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .quote-mark {
      font-family: 'Playfair Display', serif;
      font-size: 5rem;
      line-height: 0.75;
      color: var(--accent);
      display: block;
      margin-bottom: 1.25rem;
      user-select: none;
    }

    .quote-text {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.4rem, 3vw, 2.3rem);
      line-height: 1.55;
      font-weight: 400;
      color: var(--paper);
      letter-spacing: 0.01em;
      min-height: 4rem;
    }

    .quote-meta {
      margin-top: 2rem;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      min-height: 2.5rem;
    }

    .meta-divider {
      width: 36px;
      height: 1px;
      background: var(--accent);
      flex-shrink: 0;
    }

    .meta-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .character-name {
      font-size: 0.82rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--paper);
      min-height: 1rem;
    }

    .anime-name {
      font-size: 0.7rem;
      color: var(--muted);
      letter-spacing: 0.06em;
      font-style: italic;
      font-family: 'Playfair Display', serif;
      min-height: 0.9rem;
    }

    .actions {
      margin-top: 3rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-next {
      background: var(--paper);
      color: var(--ink);
      border: none;
      padding: 0.9rem 2.2rem;
      font-family: 'Syne', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: color 0.25s ease;
      flex-shrink: 0;
    }

    .btn-next::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--accent);
      transform: translateX(-101%);
      transition: transform 0.28s ease;
      z-index: 0;
    }

    .btn-next span {
      position: relative;
      z-index: 1;
    }

    .btn-next:hover::after {
      transform: translateX(0);
    }

    .btn-next:hover {
      color: #fff;
    }

    .btn-next:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--line);
      padding: 0.9rem 1.4rem;
      font-family: 'Syne', sans-serif;
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      transition: color 0.2s ease, border-color 0.2s ease;
      flex-shrink: 0;
    }

    .btn-ghost:hover {
      color: var(--paper);
      border-color: rgba(245, 240, 232, 0.3);
    }

    .btn-ghost.saved {
      color: var(--accent);
      border-color: var(--accent);
    }

    .btn-ghost.copied {
      color: #5cb85c;
      border-color: #5cb85c;
    }

    .keyboard-hint {
      font-size: 0.58rem;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    .keyboard-hint kbd {
      background: var(--surface);
      border: 1px solid var(--line);
      padding: 0.15rem 0.4rem;
      font-family: 'Syne', sans-serif;
      font-size: 0.56rem;
      color: var(--muted);
    }


    footer {
      padding: 1.25rem 3rem;
      border-top: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 1;
      flex-shrink: 0;
      gap: 1rem;
    }

    .footer-left {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .footer-text {
      font-size: 0.6rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .footer-counter {
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      color: var(--muted);
    }

    .footer-counter span {
      color: var(--accent);
      font-weight: 700;
    }

    .footer-api {
      font-size: 0.6rem;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .footer-api a {
      color: var(--muted);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .footer-api a:hover {
      color: var(--paper);
    }

    .drawer-overlay {
      position: fixed;
      inset: 0;
      background: var(--overlay);
      z-index: 99;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .drawer-overlay.visible {
      opacity: 1;
      pointer-events: all;
    }

    .favorites-drawer {
      position: fixed;
      top: 0;
      right: -100%;
      width: 400px;
      max-width: 100vw;
      height: 100vh;
      background: var(--surface);
      border-left: 1px solid var(--line);
      z-index: 100;
      display: flex;
      flex-direction: column;
      transition: right 0.32s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .favorites-drawer.open {
      right: 0;
    }

    .drawer-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .drawer-title {
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--paper);
    }

    .drawer-close {
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      padding: 0.2rem;
      transition: color 0.2s ease;
    }

    .drawer-close:hover {
      color: var(--paper);
    }

    .drawer-body {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem 2rem;
    }

    .drawer-body::-webkit-scrollbar { width: 3px; }
    .drawer-body::-webkit-scrollbar-track { background: transparent; }
    .drawer-body::-webkit-scrollbar-thumb { background: var(--line); }

    .favorites-empty {
      text-align: center;
      color: var(--muted);
      font-size: 0.78rem;
      letter-spacing: 0.04em;
      margin-top: 3rem;
      line-height: 2;
    }

    .fav-item {
      border-bottom: 1px solid var(--line);
      padding: 1.25rem 0;
      position: relative;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }

    .fav-item:last-child { border-bottom: none; }
    .fav-item:hover { opacity: 0.75; }

    .fav-quote {
      font-family: 'Playfair Display', serif;
      font-size: 0.88rem;
      line-height: 1.6;
      color: var(--paper);
      margin-bottom: 0.5rem;
      padding-right: 1.5rem;
    }

    .fav-meta {
      font-size: 0.62rem;
      letter-spacing: 0.1em;
      color: var(--muted);
      text-transform: uppercase;
    }

    .fav-remove {
      position: absolute;
      top: 1.25rem;
      right: 0;
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 0.75rem;
      padding: 0.2rem;
      transition: color 0.2s ease;
      line-height: 1;
    }

    .fav-remove:hover { color: var(--accent); }

    .drawer-footer {
      padding: 1rem 2rem;
      border-top: 1px solid var(--line);
      flex-shrink: 0;
    }

    .drawer-clear {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--muted);
      padding: 0.6rem 1rem;
      font-family: 'Syne', sans-serif;
      font-size: 0.62rem;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      width: 100%;
      transition: color 0.2s ease, border-color 0.2s ease;
    }

    .drawer-clear:hover {
      color: var(--accent);
      border-color: var(--accent);
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(1rem);
      background: var(--surface);
      border: 1px solid var(--line);
      color: var(--paper);
      font-size: 0.7rem;
      font-family: 'Syne', sans-serif;
      letter-spacing: 0.08em;
      padding: 0.75rem 1.5rem;
      z-index: 300;
      opacity: 0;
      transition: opacity 0.2s ease, transform 0.2s ease;
      white-space: nowrap;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toast.ok { border-color: #5cb85c; color: #5cb85c; }
    .toast.fail { border-color: var(--accent); color: var(--accent); }

    @media (max-width: 768px) {
      header {
        padding: 1.25rem 1.5rem;
      }

      main {
        padding: 3rem 1.5rem;
        align-items: flex-start;
      }

      .quote-mark { font-size: 3.5rem; }

      .keyboard-hint { display: none; }

      footer {
        padding: 1rem 1.5rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .footer-left { gap: 1rem; }
    }

    @media (max-width: 480px) {
      .actions {
        flex-wrap: wrap;
      }

      .btn-next { flex: 1; text-align: center; }
      .btn-ghost { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>

  <div class="loading-bar" id="loadingBar"></div>
  <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>

  <aside class="favorites-drawer" id="favDrawer">
    <div class="drawer-header">
      <span class="drawer-title">Saved Quotes</span>
      <button class="drawer-close" onclick="closeDrawer()">✕</button>
    </div>
    <div class="drawer-body" id="drawerBody"></div>
    <div class="drawer-footer">
      <button class="drawer-clear" onclick="clearFavorites()">Clear all</button>
    </div>
  </aside>

  <header>
    <div class="logo">
      <span class="logo-text">言葉 Kotoba</span>
      <span class="logo-sub">Anime Quote Archive</span>
    </div>
    <div class="header-controls">
      <button class="icon-btn" id="apiBtn" onclick="checkApi()" title="Check API status">⚡</button>
      <button class="icon-btn" id="qotdBtn" onclick="loadQotd()" title="Quote of the Day">☀</button>
      <button class="icon-btn" id="themeBtn" onclick="toggleTheme()" title="Toggle theme">◐</button>
      <button class="icon-btn" id="favBtn" onclick="openDrawer()" title="Saved quotes">
        <span class="fav-count" id="favCount">♡</span>
      </button>
    </div>
  </header>

  <main>
    <div class="quote-stage">
      <div class="quote-eyebrow">
        <span id="eyebrowLabel">—</span>
        <span class="qotd-badge" id="qotdBadge">Today's Pick</span>
      </div>
      <span class="quote-mark" aria-hidden="true">"</span>
      <p class="quote-text" id="quoteText"></p>
      <div class="quote-meta" id="quoteMeta">
        <div class="meta-divider"></div>
        <div class="meta-text">
          <span class="character-name" id="characterName"></span>
          <span class="anime-name" id="animeName"></span>
        </div>
      </div>
      <div class="actions">
        <button class="btn-next" id="nextBtn" onclick="loadQuote()">
          <span>Next Quote</span>
        </button>
        <button class="btn-ghost" id="saveBtn" onclick="toggleFavorite()">Save</button>
        <button class="btn-ghost" id="copyBtn" onclick="copyQuote()">Copy</button>
        <span class="keyboard-hint" aria-hidden="true">
          <kbd>Space</kbd><kbd>→</kbd> next &nbsp; <kbd>S</kbd> save
        </span>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-left">
      <span class="footer-text">Kotoba — Words that stayed</span>
      <span class="footer-counter">Quote <span id="quoteCounter">—</span></span>
    </div>
    <span class="footer-api">100+ quotes, zero dependencies</span>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
    const quotes = [
      { quote: "The world is not beautiful, therefore it is.", character: "Kino", anime: "Kino's Journey" },
      { quote: "Power is not will, it is the phenomenon of physically making things happen.", character: "Madara Uchiha", anime: "Naruto Shippuden" },
      { quote: "Whatever you lose, you'll find it again. But what you throw away you'll never get back.", character: "Himura Kenshin", anime: "Rurouni Kenshin" },
      { quote: "If you don't take risks, you can't create a future.", character: "Monkey D. Luffy", anime: "One Piece" },
      { quote: "Loneliness is peaceful, but there will be no one to share the peace with.", character: "Lain Iwakura", anime: "Serial Experiments Lain" },
      { quote: "People's lives don't end when they die. It ends when they lose faith.", character: "Itachi Uchiha", anime: "Naruto" },
      { quote: "The only thing we're allowed to do is believe that we won't regret the choice we made.", character: "Levi Ackerman", anime: "Attack on Titan" },
      { quote: "A dropout will beat a genius through hard work.", character: "Rock Lee", anime: "Naruto" },
      { quote: "If you don't share someone's pain, you can never understand them.", character: "Nagato", anime: "Naruto Shippuden" },
      { quote: "Even if I lose this feeling, I'm sure I'll just fall in love with you all over again.", character: "Syaoran Li", anime: "Cardcaptor Sakura" },
      { quote: "The moment you think of giving up, think of the reason why you held on so long.", character: "Natsu Dragneel", anime: "Fairy Tail" },
      { quote: "Hard work is worthless for those that don't believe in themselves.", character: "Naruto Uzumaki", anime: "Naruto" },
      { quote: "A person grows up when he's able to overcome hardships. Protection is important, but there are some things that a person must learn on his own.", character: "Jiraiya", anime: "Naruto" },
      { quote: "We are all like fireworks. We climb, shine, and always go our separate ways and become further apart. But even if that time comes, let's not disappear like a firework, and continue to shine forever.", character: "Hitsugaya Toshiro", anime: "Bleach" },
      { quote: "You can't sit around envying other people's worlds. You have to go out and change your own.", character: "Shinichi Mechazawa", anime: "Cromartie High School" },
      { quote: "Life is not a game of luck. If you wanna win, work hard.", character: "Sora", anime: "No Game No Life" },
      { quote: "It's okay to not know what you want to do with your life. The important thing is you keep moving forward.", character: "Shouko Nishimiya", anime: "A Silent Voice" },
      { quote: "Every journey begins with a single step. We just have to have patience.", character: "Milly Thompson", anime: "Trigun" },
      { quote: "Knowing you're different is only the beginning. If you accept these differences you'll be able to get past them and grow even closer.", character: "Miss Kobayashi", anime: "Miss Kobayashi's Dragon Maid" },
      { quote: "No matter how hard or impossible it is, never lose sight of your goal.", character: "Monkey D. Luffy", anime: "One Piece" },
      { quote: "I refuse to let my fear control me anymore.", character: "Izuku Midoriya", anime: "My Hero Academia" },
      { quote: "It's not about whether you can or you can't. Some things in life, you just do.", character: "Lightning", anime: "Final Fantasy XIII" },
      { quote: "The strong should aid and protect the weak. Then the weak will become strong and they in turn will aid and protect those weaker than themselves. That is the duty of the strong.", character: "Fuhrer King Bradley", anime: "Fullmetal Alchemist" },
      { quote: "Being weak is nothing to be ashamed of. Staying weak is.", character: "Fuhrer King Bradley", anime: "Fullmetal Alchemist" },
      { quote: "Mistakes are not shackles that halt one forward. To not make mistakes is the abnormality.", character: "Shogo Makishima", anime: "Psycho-Pass" },
      { quote: "Fear is not evil. It tells you what your weakness is. And once you know your weakness, you can become stronger as well as kinder.", character: "Gildarts Clive", anime: "Fairy Tail" },
      { quote: "An excellent leader must be passionate because it's their duty to keep everyone moving forward.", character: "Nico Yazawa", anime: "Love Live!" },
      { quote: "When you give up, that's when the game ends.", character: "Mitsuyoshi Anzai", anime: "Slam Dunk" },
      { quote: "If you wanna make people dream, you've gotta start by believing in that dream yourself.", character: "Seiya Kanie", anime: "Amagi Brilliant Park" },
      { quote: "To know sorrow is not terrifying. What is terrifying is to know you can't go back to happiness you could have.", character: "Matsumoto Rangiku", anime: "Bleach" },
      { quote: "You can't keep snakes from being snakes.", character: "Holo", anime: "Spice and Wolf" },
      { quote: "The ticket to the future is always open.", character: "Vash the Stampede", anime: "Trigun" },
      { quote: "I want to be a hero so badly.", character: "Izuku Midoriya", anime: "My Hero Academia" },
      { quote: "It's not the face that makes someone a monster, it's the choices they make with their lives.", character: "Naruto Uzumaki", anime: "Naruto" },
      { quote: "Whatever you do, enjoy it to the fullest. That is the secret of life.", character: "Rider", anime: "Fate/Zero" },
      { quote: "A real hero can overcome any obstacles with just a smile.", character: "All Might", anime: "My Hero Academia" },
      { quote: "Hatred and sorrow are power. They are yours to control. All you have to do is turn them into strength and use that strength to move forward.", character: "Sebastian Michaelis", anime: "Black Butler" },
      { quote: "Don't beg for things. Do it yourself, or else you won't get anything.", character: "Renton Thurston", anime: "Eureka Seven" },
      { quote: "Life is like a tube of toothpaste. When you've used all the toothpaste down to the last squeeze, that's when you've really lived. Live with all your might, and struggle as long as you have life.", character: "Mawari Zenigata", anime: "Binbougami ga!" },
      { quote: "If you just submit yourself to fate, then that's the end of it.", character: "Keiichi Maebara", anime: "Higurashi no Naku Koro ni" },
      { quote: "There is no such thing as a painless lesson. They just don't exist. Sacrifices are necessary. You can't gain anything without losing something first.", character: "Edward Elric", anime: "Fullmetal Alchemist" },
      { quote: "Equivalent exchange. I'll give you half my life, so give me half of yours.", character: "Edward Elric", anime: "Fullmetal Alchemist" },
      { quote: "A lesson without pain is meaningless. That's because no one can gain without sacrificing something.", character: "Edward Elric", anime: "Fullmetal Alchemist Brotherhood" },
      { quote: "The world is cruel, but also very beautiful.", character: "Mikasa Ackerman", anime: "Attack on Titan" },
      { quote: "If you begin to regret, you'll dull your future decisions and let others make your choices for you. All that's left for you then is to die. Nobody can foretell the outcome. Each decision you make is how you live your life.", character: "Erwin Smith", anime: "Attack on Titan" },
      { quote: "Even if we forget the faces of our friends, we will never forget the bonds that were carved into our souls.", character: "Otonashi Yuzuru", anime: "Angel Beats!" },
      { quote: "Simplicity is the easiest path to true beauty.", character: "Seijuro Akashi", anime: "Kuroko's Basketball" },
      { quote: "A small flower that blooms in the wilderness has its own beauty.", character: "Cosette", anime: "Les Misérables" },
      { quote: "Protecting someone means giving them a place to belong. Giving them a place where they can be happy.", character: "Princess Lenessia", anime: "Log Horizon" },
      { quote: "Moving on doesn't mean you forget about things. It just means you have to accept what happened and continue living.", character: "Erza Scarlet", anime: "Fairy Tail" },
      { quote: "A true friend is someone who sees the pain in your eyes while everyone else believes the smile on your face.", character: "Pain", anime: "Naruto Shippuden" },
      { quote: "Religion, ideology, resources, land, spite, love or just because. No matter how pathetic the reason, it's enough to start a war.", character: "Paine", anime: "Final Fantasy X-2" },
      { quote: "You need to accept the fact that you're not the best and have all the will to strive to be better than anyone you face.", character: "Roronoa Zoro", anime: "One Piece" },
      { quote: "If you are killed, I will kill the person who killed you.", character: "Erza Scarlet", anime: "Fairy Tail" },
      { quote: "The people's greatest fear is being laughed at. But that's the one thing that lets you escape from the script that society has provided.", character: "Nagato Yuki", anime: "The Melancholy of Haruhi Suzumiya" },
      { quote: "We're not just friends. We're nakama. People who believe in each other.", character: "Monkey D. Luffy", anime: "One Piece" },
      { quote: "Even if no one believes in you, you have to believe in yourself.", character: "Naruto Uzumaki", anime: "Naruto" },
      { quote: "If you're not willing to do that, then don't bother coming at me.", character: "Roronoa Zoro", anime: "One Piece" },
      { quote: "Sometimes I do feel like I'm a failure. Like there's no hope for me. But even so, I'm not gonna give up. Ever!", character: "Izuku Midoriya", anime: "My Hero Academia" },
      { quote: "I'll leave tomorrow's problems to tomorrow's me.", character: "Saitama", anime: "One Punch Man" },
      { quote: "Human beings are strong because we can change ourselves.", character: "Saitama", anime: "One Punch Man" },
      { quote: "I'm not gonna run away. I never go back on my word. That's my nindo, my ninja way.", character: "Naruto Uzumaki", anime: "Naruto" },
      { quote: "The most painful thing is losing yourself in the process of loving someone too much.", character: "Kaori Miyazono", anime: "Your Lie in April" },
      { quote: "Music has a power of its own, transcending all words and logic.", character: "Kousei Arima", anime: "Your Lie in April" },
      { quote: "You've grown so much, yet you still fit perfectly in my arms.", character: "Violet Evergarden", anime: "Violet Evergarden" },
      { quote: "Even the most useless person has their use somewhere.", character: "Osamu Dazai", anime: "Bungo Stray Dogs" },
      { quote: "If you're always trying to be normal, you'll never know how amazing you can be.", character: "Maya Angelou", anime: "N/A" },
      { quote: "You don't need a reason to help people.", character: "Zidane Tribal", anime: "Final Fantasy IX" },
      { quote: "All this time, I seriously thought that it's better to die than to live your life alone.", character: "Kirito", anime: "Sword Art Online" },
      { quote: "Living is a continuous process of choosing what kind of person to become.", character: "Ginko", anime: "Mushishi" },
      { quote: "Life isn't just about passing on your genes. We can leave behind much more than just DNA. Through speech, music, literature and movies — what we've seen, heard, felt, anger, joy and sorrow — these are the things I will pass on.", character: "Big Boss", anime: "Metal Gear Solid" },
      { quote: "The world is full of obvious things which nobody by any chance ever observes.", character: "L Lawliet", anime: "Death Note" },
      { quote: "I am justice!", character: "Light Yagami", anime: "Death Note" },
      { quote: "This world is rotten and those who are making it rot deserve to die.", character: "Light Yagami", anime: "Death Note" },
      { quote: "A weapon is only as good as the person using it.", character: "Kiritsugu Emiya", anime: "Fate/Zero" },
      { quote: "If an angel, who has the purest of hearts, can lose it after seeing the atrocities humans commit, then what future does humanity have?", character: "Johan Liebert", anime: "Monster" },
      { quote: "No matter what path you take in life, don't give up on what you believe in.", character: "Alphonse Elric", anime: "Fullmetal Alchemist" },
      { quote: "Tears are how our heart speaks when our lips cannot describe how much we've been hurt.", character: "Jellal Fernandes", anime: "Fairy Tail" },
      { quote: "I want to be someone who has the strength to turn regret into motivation.", character: "Shouyou Hinata", anime: "Haikyu!!" },
      { quote: "Today might be the last time. There's no guarantee tomorrow will come. That's why I want to live without regrets.", character: "Kenma Kozume", anime: "Haikyu!!" },
      { quote: "The only home we have is the one we make.", character: "Nausicaä", anime: "Nausicaä of the Valley of the Wind" },
      { quote: "I think death is equally terrible for everyone. Young people, old people, the good, the bad — it's always the same. It's rather fair in its treatment. There's no such thing as a bad way to die.", character: "Yuri", anime: "Angel Beats!" },
      { quote: "The past is the past and the future is the future. A man is a man, and a woman is a woman. I am who I am, and you are who you are.", character: "Ryuuji Takasu", anime: "Toradora!" },
      { quote: "A dream is worth less than nothing if you don't have someone else to share it.", character: "Dousan Saitou", anime: "The Ambition of Oda Nobuna" },
      { quote: "Anything can happen. No one said life was fair.", character: "Misaki Ayuzawa", anime: "Maid Sama!" },
      { quote: "If you can't do something, then don't. Focus on what you can do.", character: "Shiroe", anime: "Log Horizon" },
      { quote: "Those who stand at the top determine what's wrong and what's right! This very place is neutral ground! Justice will prevail, you say? But of course it will! Whoever wins this war becomes justice!", character: "Don Quixote Doflamingo", anime: "One Piece" },
      { quote: "The sea's expanse is not determined by its depth but by its breadth.", character: "Silvers Rayleigh", anime: "One Piece" },
      { quote: "People, who can't throw something important away, can never hope to change anything.", character: "Armin Arlert", anime: "Attack on Titan" },
      { quote: "Sometimes, people are just mean. Don't fight mean with mean. Hold your head high.", character: "Tohru Honda", anime: "Fruits Basket" },
      { quote: "We don't have to know what tomorrow holds. That's why we can live for everything we're worth today.", character: "Fruits Basket Character", anime: "Fruits Basket" },
      { quote: "Forgive me for being selfish. I just... I want to live.", character: "Homura Akemi", anime: "Puella Magi Madoka Magica" },
      { quote: "Just be yourself, as long as you don't hurt others in the process.", character: "Kira Yamato", anime: "Gundam SEED" },
    ];

    let quoteCount = 0;

    let busy = false;
    let current = { quote: '', character: '', anime: '' };
    let recentIdx = [];

    function bar(state) {
      const el = document.getElementById('loadingBar');
      el.className = 'loading-bar';
      if (state === 'start') requestAnimationFrame(() => el.classList.add('running'));
      if (state === 'done') {
        el.classList.add('done');
        setTimeout(() => el.className = 'loading-bar', 300);
      }
    }

    function render(quote, character, anime) {
      current = { quote, character, anime };
      document.getElementById('quoteText').textContent = quote;
      document.getElementById('characterName').textContent = character;
      document.getElementById('animeName').textContent = anime;
      updateSaveBtn();
    }

    function swap(callback) {
      const text = document.getElementById('quoteText');
      const meta = document.getElementById('quoteMeta');
      text.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
      meta.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
      text.style.opacity = '0';
      text.style.transform = 'translateY(8px)';
      meta.style.opacity = '0';
      meta.style.transform = 'translateY(8px)';
      setTimeout(() => {
        callback();
        text.style.opacity = '1';
        text.style.transform = 'translateY(0)';
        meta.style.opacity = '1';
        meta.style.transform = 'translateY(0)';
      }, 250);
    }

    function pickQuote() {
      const available = quotes.map((_, i) => i).filter(i => !recentIdx.includes(i));
      const pool = available.length > 0 ? available : quotes.map((_, i) => i);
      const idx = pool[Math.floor(Math.random() * pool.length)];
      recentIdx.push(idx);
      if (recentIdx.length > Math.floor(quotes.length / 2)) recentIdx.shift();
      return quotes[idx];
    }

    function loadQuote() {
      if (busy) return;
      busy = true;

      const btn = document.getElementById('nextBtn');
      btn.disabled = true;

      setQotd(false);
      bar('start');

      const data = pickQuote();
      quoteCount++;
      bar('done');

      swap(() => {
        render(data.quote, data.character, data.anime);
        document.getElementById('eyebrowLabel').textContent = `Series #${quoteCount}`;
        document.getElementById('quoteCounter').textContent = String(quoteCount).padStart(3, '0');
      });

      setTimeout(() => {
        btn.disabled = false;
        busy = false;
      }, 320);
    }

    function setQotd(on) {
      document.getElementById('qotdBadge').classList.toggle('visible', on);
      document.getElementById('qotdBtn').classList.toggle('active', on);
    }

    function loadQotd() {
      const today = new Date().toISOString().slice(0, 10);
      const stored = localStorage.getItem('kotoba_qotd');

      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (parsed.date === today) {
            swap(() => {
              render(parsed.quote, parsed.character, parsed.anime);
              document.getElementById('eyebrowLabel').textContent = 'Quote of the Day';
              setQotd(true);
            });
            return;
          }
        } catch {}
      }

      const idx = dateHash(today) % quotes.length;
      const fallbackPick = quotes[idx];

      localStorage.setItem('kotoba_qotd', JSON.stringify({ date: today, ...fallbackPick }));
      swap(() => {
        render(fallbackPick.quote, fallbackPick.character, fallbackPick.anime);
        document.getElementById('eyebrowLabel').textContent = 'Quote of the Day';
        setQotd(true);
      });
    }

    function dateHash(str) {
      let h = 0;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(31, h) + str.charCodeAt(i) | 0;
      }
      return Math.abs(h);
    }

    function getFavs() {
      try { return JSON.parse(localStorage.getItem('kotoba_favs') || '[]'); }
      catch { return []; }
    }

    function saveFavs(list) {
      localStorage.setItem('kotoba_favs', JSON.stringify(list));
    }

    function isSaved() {
      return getFavs().some(f => f.quote === current.quote);
    }

    function toggleFavorite() {
      let list = getFavs();
      if (isSaved()) {
        list = list.filter(f => f.quote !== current.quote);
      } else {
        list.unshift({ ...current, at: Date.now() });
      }
      saveFavs(list);
      updateSaveBtn();
      renderDrawer();
    }

    function updateSaveBtn() {
      const btn = document.getElementById('saveBtn');
      const countEl = document.getElementById('favCount');
      const saved = isSaved();
      const count = getFavs().length;

      btn.textContent = saved ? 'Saved ♥' : 'Save';
      btn.classList.toggle('saved', saved);
      countEl.textContent = count > 0 ? `♥ ${count}` : '♡';
      document.getElementById('favBtn').classList.toggle('active', count > 0);
    }

    function openDrawer() {
      renderDrawer();
      document.getElementById('favDrawer').classList.add('open');
      document.getElementById('drawerOverlay').classList.add('visible');
      document.body.style.overflow = 'hidden';
    }

    function closeDrawer() {
      document.getElementById('favDrawer').classList.remove('open');
      document.getElementById('drawerOverlay').classList.remove('visible');
      document.body.style.overflow = '';
    }

    function renderDrawer() {
      const body = document.getElementById('drawerBody');
      const list = getFavs();
      if (list.length === 0) {
        body.innerHTML = '<p class="favorites-empty">No saved quotes yet.<br>Hit Save on any quote<br>to keep it here.</p>';
        return;
      }
      body.innerHTML = list.map((item, i) => `
        <div class="fav-item" onclick="loadFav(${i})">
          <p class="fav-quote">"${item.quote}"</p>
          <p class="fav-meta">${item.character} — ${item.anime}</p>
          <button class="fav-remove" onclick="removeFav(event,${i})">✕</button>
        </div>
      `).join('');
    }

    function loadFav(i) {
      const item = getFavs()[i];
      if (!item) return;
      closeDrawer();
      swap(() => {
        render(item.quote, item.character, item.anime);
        document.getElementById('eyebrowLabel').textContent = 'From your saved quotes';
        setQotd(false);
      });
    }

    function removeFav(e, i) {
      e.stopPropagation();
      const list = getFavs();
      list.splice(i, 1);
      saveFavs(list);
      renderDrawer();
      updateSaveBtn();
    }

    function clearFavorites() {
      saveFavs([]);
      renderDrawer();
      updateSaveBtn();
    }

    function copyQuote() {
      const btn = document.getElementById('copyBtn');
      const text = `"${current.quote}" — ${current.character} (${current.anime})`;
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = 'Copied ✓';
        btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
      }).catch(() => {
        btn.textContent = 'Failed';
        setTimeout(() => btn.textContent = 'Copy', 2000);
      });
    }

    function showToast(msg, type) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.className = 'toast show ' + type;
      clearTimeout(el._timer);
      el._timer = setTimeout(() => el.className = 'toast', 3000);
    }

    function checkApi() {
      showToast(`${quotes.length} quotes loaded — no API needed`, 'ok');
    }

    function toggleTheme() {
      const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('kotoba_theme', next);
    }

    document.addEventListener('keydown', (e) => {
      if (['INPUT', 'SELECT', 'TEXTAREA'].includes(document.activeElement.tagName)) return;
      if (e.key === ' ' || e.key === 'ArrowRight') { e.preventDefault(); loadQuote(); }
      if (e.key === 's' || e.key === 'S') toggleFavorite();
      if (e.key === 'Escape') closeDrawer();
      if (e.key === 'd' || e.key === 'D') loadQotd();
    });

    const savedTheme = localStorage.getItem('kotoba_theme');
    if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);

    updateSaveBtn();
    loadQuote();
  </script>
</body>
</html>
